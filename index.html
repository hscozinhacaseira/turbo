<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistente de Vendas - MDTURBOS</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
        body { font-family: 'Roboto', sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        #chat-container { width: 500px; max-width: 95%; height: 700px; border-radius: 15px; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15); display: flex; flex-direction: column; overflow: hidden; background-color: #fff; }
        #chat-header { background: linear-gradient(90deg, #1d3557, #457b9d); color: white; padding: 20px; text-align: center; font-weight: bold; font-size: 1.3em; border-bottom: 4px solid #e63946; }
        #chat-messages { flex-grow: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; }
        .message { padding: 10px 18px; border-radius: 20px; max-width: 90%; line-height: 1.5; word-wrap: break-word; }
        .bot-message { background-color: #e9ecef; color: #333; align-self: flex-start; border-bottom-left-radius: 5px; }
        .bot-message pre { white-space: pre-wrap; font-family: inherit; margin: 0; font-size: 0.9em; }
        .user-message { background-color: #1d3557; color: white; align-self: flex-end; border-bottom-right-radius: 5px; }
        #chat-form { display: flex; border-top: 1px solid #ddd; padding: 10px; }
        #chat-input { flex-grow: 1; border: 1px solid #ccc; border-radius: 20px; padding: 10px 15px; font-size: 1em; outline: none; margin-right: 10px; }
        #send-button { background-color: #e63946; border: none; color: white; padding: 0 20px; border-radius: 20px; font-weight: bold; cursor: pointer; transition: background-color 0.3s; }
        #send-button:hover { background-color: #d62828; }
    </style>
</head>
<body>

<div id="chat-container">
    <div id="chat-header">Agente de Vendas N1 MDTURBOS</div>
    <div id="chat-messages"></div>
    <form id="chat-form">
        <input type="text" id="chat-input" placeholder="Digite sua mensagem..." autocomplete="off">
        <button id="send-button" type="submit">Enviar</button>
    </form>
</div>

<script>
    const chatForm = document.getElementById('chat-form');
    const chatInput = document.getElementById('chat-input');
    const chatMessages = document.getElementById('chat-messages');

    let conversationState = 'START';
    let lastFoundProducts = [];
    const userData = { nome: '', celular: '', produto: null };

    // --- SIMULA√á√ÉO DA PLANILHA DE ESTOQUE ---
    // Dados extra√≠dos do seu CSV com a adi√ß√£o da coluna 'Estoque' para simula√ß√£o.
    const stockDB = [
        { "Nome_Produto": "TOYOTA RAV4 2.0 D-4D 1CD-FTV - 116HP 2001-2005", "PN_Alternativos": "BC.0005", "Modelos": "BC GT1749V", "Medidas": "EIXO 36/43 ROTOR 34,65/49", "Estoque": 8 },
        { "Nome_Produto": "SCANIA 143/144 (530HP) SCANIA TRUCK 460HP", "PN_Alternativos": "BC.0007", "Modelos": "BC HX60", "Medidas": "EIXO 92/97 ROTOR 76/109", "Estoque": 3 },
        { "Nome_Produto": "FORD F4000 /F350/ F250 2.8 CUMMINS ISF 2.8 EURO 5", "PN_Alternativos": "BC.0027", "Modelos": "BC HE200WG", "Medidas": "EIXO 44/49 ROTOR 41/58,16", "Estoque": 0 },
        { "Nome_Produto": "CATERPILLAR TRUCK - CT660 - C10/C12", "PN_Alternativos": "BC.0028", "Modelos": "BC GTA4294", "Medidas": "EIXO 75,1/82 ROTOR 67,73/94", "Estoque": 5 },
        { "Nome_Produto": "GM S10/TROLLER /BLAZER EURO II - M.W.M 4.07 TCA 2.8", "PN_Alternativos": "BC.0043", "Modelos": "BC TF035HM-12T-6", "Medidas": "EIXO 36,1/43,1 ROTOR 37,8/49", "Estoque": 15 },
        { "Nome_Produto": "VW DELIVERY 5140E 8150E 9150E EURO3 2005 ATE 2016", "PN_Alternativos": "BC.0311", "Modelos": "BC K14", "Medidas": "EIXO 41,9/49,9 ROTOR 44,2/62", "Estoque": 11 }
    ];

    function displayMessage(text, sender, isHtml = false) {
        const messageEl = document.createElement('div');
        messageEl.classList.add('message', `${sender}-message`);
        if (isHtml) {
            messageEl.innerHTML = text;
        } else {
            messageEl.innerText = text;
        }
        chatMessages.appendChild(messageEl);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function botSay(text, delay = 600, isHtml = false) {
        setTimeout(() => displayMessage(text, 'bot', isHtml), delay);
    }
    
    function displayFinalRemarks() {
        botSay("Obrigado! Antes de finalizar, seguem umas dicas importantes:", 800);
        botSay("1. Modelos: Turbinas eletr√¥nicas, que podem utilizar geometria vari√°vel, s√£o pe√ßas complexas. Confirme sempre a aplica√ß√£o correta.", 1800);
        botSay("2. Verifica√ß√£o: O ideal √© sempre confirmar o c√≥digo original do seu ve√≠culo na plaqueta da turbina para garantir a compra da pe√ßa correta.", 2800);
        botSay("3. Instala√ß√£o: A troca exige conhecimento especializado e balanceamento. Recomendo que seja feita por um profissional para n√£o perder a garantia. üí™", 3800);
    }

    function processProductSelection(product) {
        userData.produto = product;
        if (product.Estoque > 0) {
            botSay(`√ìtima escolha! O item "${product.Nome_Produto}" est√° dispon√≠vel. Temos ${product.Estoque} unidades.`);
            botSay(`Posso gerar um or√ßamento para voc√™? (sim/n√£o)`);
            conversationState = 'CONFIRM_ORCAMENTO';
        } else {
            botSay(`O item "${product.Nome_Produto}" est√° indispon√≠vel no momento. üò• Quer que um vendedor verifique o prazo de reposi√ß√£o para voc√™?`);
            conversationState = 'FORWARD_TO_SALES';
        }
    }
    
    function processInput(input) {
        displayMessage(input, 'user');
        chatInput.value = '';

        switch (conversationState) {
            case 'START':
                userData.nome = input;
                botSay(`Prazer, ${userData.nome}! ü§ó Para agilizar, qual seu celular com DDD?`);
                conversationState = 'GET_CELULAR';
                break;

            case 'GET_CELULAR':
                userData.celular = input;
                botSay(`Obrigado! Do que voc√™ precisa hoje? Pode me dizer o nome, PN ou modelo do ve√≠culo. üöó`);
                conversationState = 'GET_PRODUCT';
                break;

            case 'GET_PRODUCT':
                const searchTerm = input.toLowerCase();
                lastFoundProducts = stockDB.filter(p =>
                    p.Nome_Produto.toLowerCase().includes(searchTerm) ||
                    p.Modelos.toLowerCase().includes(searchTerm) ||
                    p.PN_Alternativos.toLowerCase().includes(searchTerm)
                );

                if (lastFoundProducts.length === 1) {
                    processProductSelection(lastFoundProducts[0]);
                } else if (lastFoundProducts.length > 1) {
                    botSay(`Encontrei ${lastFoundProducts.length} itens. Veja os detalhes abaixo e digite o n√∫mero do item que voc√™ deseja:`);
                    let productList = '';
                    lastFoundProducts.forEach((p, index) => {
                        productList += `<strong>${index + 1}. ${p.Nome_Produto}</strong>\n`;
                        productList += `<pre>   PN: ${p.PN_Alternativos}\n   Modelo: ${p.Modelos}\n   Medidas: ${p.Medidas}</pre><hr>`;
                    });
                    botSay(productList, 800, true);
                    conversationState = 'CHOOSE_FROM_LIST';
                } else {
                    botSay(`N√£o encontrei essa pe√ßa com "${input}". ü§î Vou passar seu contato para um vendedor fazer uma busca mais espec√≠fica, ok?`);
                    displayFinalRemarks();
                    conversationState = 'ENDED';
                }
                break;

            case 'CHOOSE_FROM_LIST':
                const choice = parseInt(input, 10);
                if (!isNaN(choice) && choice > 0 && choice <= lastFoundProducts.length) {
                    const selectedProduct = lastFoundProducts[choice - 1];
                    processProductSelection(selectedProduct);
                } else {
                    botSay("Por favor, digite um n√∫mero v√°lido da lista acima.");
                }
                break;
            
            case 'CONFIRM_ORCAMENTO':
                if (input.toLowerCase().startsWith('s')) {
                    botSay(`Legal! Para adiantar, qual a forma de pagamento que prefere (Pix, Cart√£o, Boleto)?`);
                    conversationState = 'GET_PAYMENT';
                } else {
                    botSay('Sem problemas! Se precisar de outra pe√ßa, √© s√≥ chamar. üòâ');
                    conversationState = 'GET_PRODUCT';
                }
                break;

            case 'GET_PAYMENT':
                const pagamento = input;
                botSay(`Perfeito! Criei um bilhete para o vendedor: 1x ${userData.produto.Nome_Produto}, pgto: ${pagamento}.`);
                botSay(`Ele entrar√° em contato com voc√™ em breve pelo n√∫mero ${userData.celular}.`);
                displayFinalRemarks();
                conversationState = 'ENDED';
                break;
            
            case 'FORWARD_TO_SALES':
                 botSay(`Ok! Um de nossos vendedores entrar√° em contato com voc√™ pelo n√∫mero ${userData.celular} para te ajudar. `);
                 displayFinalRemarks();
                 conversationState = 'ENDED';
                 break;
        }
    }

    chatForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const userInput = chatInput.value.trim();
        if (userInput) processInput(userInput);
    });

    botSay('Ol√°! Sou o assistente de vendas da MD TURBOS. Para come√ßarmos, qual o seu nome?');

</script>
</body>
</html>
